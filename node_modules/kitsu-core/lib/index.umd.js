!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(t.kitsuCore={})}(this,function(t){function r(t){return new Promise(function(n,e){if("object"==typeof t&&null!==t){return Array.isArray(t)?t.map(function(t){return new Promise(function(n,e){return n(r(t))})}).then(function(t){try{return i.call(this)}catch(t){return e(t)}}.bind(this),e):(t.attributes&&t.attributes.constructor===Object&&(Object.keys(t.attributes).forEach(function(r){t[r]=t.attributes[r]}),delete t.attributes),i.call(this));function i(){return u.call(this)}}function u(){return n(t)}return u.call(this)})}function n(t){if(t.response){var r=t.response.data;r&&r.errors&&(t.errors=r.errors)}throw t}function e(t,r){var e=r.id,i=r.type;return new Promise(function(r,u){try{var o=t.filter(function(t){return t.id===e&&t.type===i})[0]||{id:e,type:i};return r(Object.assign({},o))}catch(t){n(t)}return r()})}function i(t,n){var i=t.id,o=t.type,c=t.meta;return new Promise(function(t,a){var s;return e(n,{id:i,type:o}).then(function(e){try{if((s=e).relationships)return u(s,n).then(function(t){try{return i.call(this)}catch(t){return a(t)}}.bind(this),a);function i(){return c&&(s.meta=c),t(r(s))}return i.call(this)}catch(t){return a(t)}}.bind(this),a)})}function u(t,r){return new Promise(function(n,e){var u,o;o=!1;var c,a,s,h=[],f=[],l=[];return(u=t.relationships).then(function(d){try{{for(s in d)l.push(s);for(;l.length;)a=l.shift(),f.push(a);for(;f.length;)c=f.shift(),h.push(c);var p;function y(n){if(!h.length)return[1];{if(n=h.shift(),u[n].data&&Array.isArray(u[n].data))return function(t,r,n){return new Promise(function(e,u){var o,c;function a(){var t=c();return s.bind(this,t[0],t[1])}function s(e,o){return c=function(){return[e,o]},!(o[1]=o[0].next()).done&&(e=o[1].value,1)?i(e,r).then(function(r){try{return t[n].push(r),a}catch(t){return u(t)}},u):[1]}return t[n]=[],t.relationships[n].data.then(function(t){try{return(o=function(t){for(;t;){if(t.then)return void t.then(o,u);try{if(t.pop){if(t.length)return t.pop()?r.call(this):t;t=a}else t=t.call(this)}catch(t){return u(t)}}}.bind(this))(s.bind(this,void 0,[t[Symbol.iterator]()]));function r(){return e()}}catch(t){return u(t)}}.bind(this),u)})}(t,r,n).then(function(t){try{return o=!0,a.call(this)}catch(t){return e(t)}}.bind(this),e);{if(u[n].data)return function(t,r,n){return new Promise(function(e,u){return i(t.relationships[n].data,r).then(function(r){try{return t[n]=r,delete t[n].relationships,e()}catch(t){return u(t)}},u)})}(t,r,n).then(function(t){try{return o=!0,c.call(this)}catch(t){return e(t)}}.bind(this),e);function c(){return a.call(this)}return c.call(this)}function a(){return y}}}return(p=function(t){for(;t;){if(t.then)return void t.then(p,e);try{if(t.pop){if(t.length)return t.pop()?b.call(this):t;t=y}else t=t.call(this)}catch(t){return e(t)}}}.bind(this))(y.bind(this,void 0));function b(){return o&&delete t.relationships,n(t)}}}catch(t){return e(t)}}.bind(this),e)})}function o(t,r){var n="";for(var e in t){var i=t[e];r&&(n+="&"+r),n+="object"==typeof i?"["+e+"]"+o(i):"["+e+"]="+i}return n}var c=function(t,r){return t+" requires an ID for the "+r+" relationships"};t.camel=function(t){return t.replace(/[-_][a-z\u00E0-\u00F6\u00F8-\u00FE]/g,function(t){return t.slice(1).toUpperCase()})},t.kebab=function(t){return t.charAt(0).toLowerCase()+t.slice(1).replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,function(t){return"-"+t.toLowerCase()})},t.snake=function(t){return t.charAt(0).toLowerCase()+t.slice(1).replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,function(t){return"_"+t.toLowerCase()})},t.deattribute=r,t.deserialise=function(t){return new Promise(function(n,e){if(t.data&&t.data.constructor===Array)return function(t){return new Promise(function(n,e){var i,o;function c(){var t=o();return a.bind(this,t[0],t[1])}function a(n,i){if(o=function(){return[n,i]},!(i[1]=i[0].next()).done&&(n=i[1].value,1)){if(t.included)return u(n,t.included).then(function(t){try{return n=t,a.call(this)}catch(t){return e(t)}}.bind(this),e);function a(){if(n.attributes)return r(n).then(function(t){try{return n=t,i.call(this)}catch(t){return e(t)}}.bind(this),e);function i(){return t.data[t.data.indexOf(n)]=n,c}return i.call(this)}return a.call(this)}return[1]}return t.data.then(function(r){try{return(i=function(t){for(;t;){if(t.then)return void t.then(i,e);try{if(t.pop){if(t.length)return t.pop()?u.call(this):t;t=c}else t=t.call(this)}catch(t){return e(t)}}}.bind(this))(a.bind(this,void 0,[r[Symbol.iterator]()]));function u(){return n(t)}}catch(t){return e(t)}}.bind(this),e)})}(t).then(function(r){try{return t=r,o.call(this)}catch(t){return e(t)}}.bind(this),e);{if(t.included)return u(t.data,t.included).then(function(r){try{return t.data=r,i.call(this)}catch(t){return e(t)}}.bind(this),e);function i(){return o.call(this)}return i.call(this)}function o(){if(delete t.included,t.data&&t.data.attributes)return r(t.data).then(function(r){try{return t.data=r,i.call(this)}catch(t){return e(t)}}.bind(this),e);function i(){return n(t)}return i.call(this)}})},t.error=n,t.filterIncludes=e,t.linkRelationships=u,t.query=function(t,r){void 0===r&&(r=!1);var n="";for(var e in t){var i=t[e];n+="object"==typeof i?o(i,e):"&"+e+"="+i}return n=encodeURI(n.slice(1)),t?r?"?"+n:n:""},t.serialise=function(t,r,e){return void 0===r&&(r={}),void 0===e&&(e="POST"),new Promise(function(i,u){var o=this;try{if(r.constructor!==Object||0===Object.keys(r).length)throw new Error(e+" requires a JSON object body");var a=this.plural(this.camel(t)),s={type:a};if("POST"!==e&&!r.id)throw new Error(e+" requires an ID for the "+a+" type");"POST"!==e&&(s.id=r.id.toString());var h=function(t){if(null!==r[t]&&r[t].constructor===Object){if("string"!=typeof r[t].id)throw new Error(c(e,t));s.relationships||(s.relationships={}),r[t].type||(r[t].type=o.plural(o.camel(t))),s.relationships[t]={data:Object.assign(r[t])}}else if(null!==r[t]&&Array.isArray(r[t])){var n=o.plural(o.camel(t));s.relationships||(s.relationships={}),s.relationships[t]={data:r[t].map(function(r){if(!r.id)throw new Error(c(e,t));return{id:r.id,type:r.type||n}})}}else"id"!==t&&"type"!==t&&(s.attributes||(s.attributes={}),s.attributes[t]=r[t])};for(var f in r)h(f);return i({data:s})}catch(t){throw n(t)}return i()}.bind(this))}});
//# sourceMappingURL=index.umd.js.map
