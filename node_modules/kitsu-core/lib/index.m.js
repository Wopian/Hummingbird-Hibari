function t(r){return new Promise(function(n,e){if("object"==typeof r&&null!==r){return Array.isArray(r)?r.map(function(r){return new Promise(function(n,e){return n(t(r))})}).then(function(t){try{return i.call(this)}catch(t){return e(t)}}.bind(this),e):(r.attributes&&r.attributes.constructor===Object&&(Object.keys(r.attributes).forEach(function(t){r[t]=r.attributes[t]}),delete r.attributes),i.call(this));function i(){return u.call(this)}}function u(){return n(r)}return u.call(this)})}function r(t){if(t.response){var r=t.response.data;r&&r.errors&&(t.errors=r.errors)}throw t}function n(t,n){var e=n.id,i=n.type;return new Promise(function(n,u){try{var a=t.filter(function(t){return t.id===e&&t.type===i})[0]||{id:e,type:i};return n(Object.assign({},a))}catch(t){r(t)}return n()})}function e(r,e){var u=r.id,a=r.type,c=r.meta;return new Promise(function(r,o){var s;return n(e,{id:u,type:a}).then(function(n){try{if((s=n).relationships)return i(s,e).then(function(t){try{return u.call(this)}catch(t){return o(t)}}.bind(this),o);function u(){return c&&(s.meta=c),r(t(s))}return u.call(this)}catch(t){return o(t)}}.bind(this),o)})}function i(t,r){return new Promise(function(n,i){var u,a;a=!1;var c,o,s,h=[],f=[],l=[];return(u=t.relationships).then(function(d){try{{for(s in d)l.push(s);for(;l.length;)o=l.shift(),f.push(o);for(;f.length;)c=f.shift(),h.push(c);var p;function b(n){if(!h.length)return[1];{if(n=h.shift(),u[n].data&&Array.isArray(u[n].data))return function(t,r,n){return new Promise(function(i,u){var a,c;function o(){var t=c();return s.bind(this,t[0],t[1])}function s(i,a){return c=function(){return[i,a]},!(a[1]=a[0].next()).done&&(i=a[1].value,1)?e(i,r).then(function(r){try{return t[n].push(r),o}catch(t){return u(t)}},u):[1]}return t[n]=[],t.relationships[n].data.then(function(t){try{return(a=function(t){for(;t;){if(t.then)return void t.then(a,u);try{if(t.pop){if(t.length)return t.pop()?r.call(this):t;t=o}else t=t.call(this)}catch(t){return u(t)}}}.bind(this))(s.bind(this,void 0,[t[Symbol.iterator]()]));function r(){return i()}}catch(t){return u(t)}}.bind(this),u)})}(t,r,n).then(function(t){try{return a=!0,o.call(this)}catch(t){return i(t)}}.bind(this),i);{if(u[n].data)return function(t,r,n){return new Promise(function(i,u){return e(t.relationships[n].data,r).then(function(r){try{return t[n]=r,delete t[n].relationships,i()}catch(t){return u(t)}},u)})}(t,r,n).then(function(t){try{return a=!0,c.call(this)}catch(t){return i(t)}}.bind(this),i);function c(){return o.call(this)}return c.call(this)}function o(){return b}}}return(p=function(t){for(;t;){if(t.then)return void t.then(p,i);try{if(t.pop){if(t.length)return t.pop()?y.call(this):t;t=b}else t=t.call(this)}catch(t){return i(t)}}}.bind(this))(b.bind(this,void 0));function y(){return a&&delete t.relationships,n(t)}}}catch(t){return i(t)}}.bind(this),i)})}function u(r){return new Promise(function(n,e){if(r.data&&r.data.constructor===Array)return function(r){return new Promise(function(n,e){var u,a;function c(){var t=a();return o.bind(this,t[0],t[1])}function o(n,u){if(a=function(){return[n,u]},!(u[1]=u[0].next()).done&&(n=u[1].value,1)){if(r.included)return i(n,r.included).then(function(t){try{return n=t,o.call(this)}catch(t){return e(t)}}.bind(this),e);function o(){if(n.attributes)return t(n).then(function(t){try{return n=t,i.call(this)}catch(t){return e(t)}}.bind(this),e);function i(){return r.data[r.data.indexOf(n)]=n,c}return i.call(this)}return o.call(this)}return[1]}return r.data.then(function(t){try{return(u=function(t){for(;t;){if(t.then)return void t.then(u,e);try{if(t.pop){if(t.length)return t.pop()?i.call(this):t;t=c}else t=t.call(this)}catch(t){return e(t)}}}.bind(this))(o.bind(this,void 0,[t[Symbol.iterator]()]));function i(){return n(r)}}catch(t){return e(t)}}.bind(this),e)})}(r).then(function(t){try{return r=t,a.call(this)}catch(t){return e(t)}}.bind(this),e);{if(r.included)return i(r.data,r.included).then(function(t){try{return r.data=t,u.call(this)}catch(t){return e(t)}}.bind(this),e);function u(){return a.call(this)}return u.call(this)}function a(){if(delete r.included,r.data&&r.data.attributes)return t(r.data).then(function(t){try{return r.data=t,i.call(this)}catch(t){return e(t)}}.bind(this),e);function i(){return n(r)}return i.call(this)}})}function a(t,r){var n="";for(var e in t){var i=t[e];r&&(n+="&"+r),n+="object"==typeof i?"["+e+"]"+a(i):"["+e+"]="+i}return n}function c(t,r){void 0===r&&(r=!1);var n="";for(var e in t){var i=t[e];n+="object"==typeof i?a(i,e):"&"+e+"="+i}return n=encodeURI(n.slice(1)),t?r?"?"+n:n:""}var o=function(t,r){return t+" requires an ID for the "+r+" relationships"};function s(t,n,e){return void 0===n&&(n={}),void 0===e&&(e="POST"),new Promise(function(i,u){var a=this;try{if(n.constructor!==Object||0===Object.keys(n).length)throw new Error(e+" requires a JSON object body");var c=this.plural(this.camel(t)),s={type:c};if("POST"!==e&&!n.id)throw new Error(e+" requires an ID for the "+c+" type");"POST"!==e&&(s.id=n.id.toString());var h=function(t){if(null!==n[t]&&n[t].constructor===Object){if("string"!=typeof n[t].id)throw new Error(o(e,t));s.relationships||(s.relationships={}),n[t].type||(n[t].type=a.plural(a.camel(t))),s.relationships[t]={data:Object.assign(n[t])}}else if(null!==n[t]&&Array.isArray(n[t])){var r=a.plural(a.camel(t));s.relationships||(s.relationships={}),s.relationships[t]={data:n[t].map(function(n){if(!n.id)throw new Error(o(e,t));return{id:n.id,type:n.type||r}})}}else"id"!==t&&"type"!==t&&(s.attributes||(s.attributes={}),s.attributes[t]=n[t])};for(var f in n)h(f);return i({data:s})}catch(t){throw r(t)}return i()}.bind(this))}function h(t){return t.replace(/[-_][a-z\u00E0-\u00F6\u00F8-\u00FE]/g,function(t){return t.slice(1).toUpperCase()})}function f(t){return t.charAt(0).toLowerCase()+t.slice(1).replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,function(t){return"-"+t.toLowerCase()})}function l(t){return t.charAt(0).toLowerCase()+t.slice(1).replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,function(t){return"_"+t.toLowerCase()})}export{h as camel,f as kebab,l as snake,t as deattribute,u as deserialise,r as error,n as filterIncludes,i as linkRelationships,c as query,s as serialise};
//# sourceMappingURL=index.m.js.map
